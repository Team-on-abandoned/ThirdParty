<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- http://hge.relishgames.com -->

<html>

<head>
<meta name="Keywords" content="game engine, 2d, hardware accelerated, hge, engine, relish games, game development">
<meta name="Description" content="Haaf's Game Engine - Hardware accelerated 2D games engine">
<title>Haaf's Game Engine - Игровой 2D движок с поддержкой аппаратного ускорения</title>
<link rel=stylesheet type=text/css href=hge.css>
<script language="JavaScript" src="hge.js"></script>
</head>

<body onload="setContents('cnt_tutorials.html');" bgcolor=#ffffff text=#000000 link=#7F0000 vlink=#7F0000 alink=#7F0000 marginwidth=0 marginheight=0 leftmargin=0 topmargin=0>
<table height=100% cellspacing=0 cellpadding=0 border=0><tr>

<td valign=top>
<table width=566 cellspacing=0 cellpadding=20 border=0><tr><td>
<h1 style="margin-top:0px">Пример 05 - Использование сетки искажения</h1>
<p>
<b>В</b> этом примере мы научимся как использовать сетку искажения, техника, позволяющая создавать 
эффекты типа воды, линз, скручивания страницы, различные изгибы и даже морфинг в реальном времени. В 
этом примере мы используем статическую текстуру, но вы можете в своей игре нарисовать в текстуру 
целую сцену, используя цель рендеринга и затем вывести на экран с помощью сетки искажения, чтобы 
достичь прикольных эффектов в реальном времени.
<br><br>
<img src="t05_1.gif" width=150 height=113>&nbsp;&nbsp;
<img src="t05_2.gif" width=150 height=113>&nbsp;&nbsp;
<img src="t05_3.gif" width=150 height=113>&nbsp;&nbsp;
<br><br>
Для начала мы подключим требуемые заголовки и объявим переменные для работы с нашей текстурой и 
сеткой искажения:
</p>
<pre>
#include &lt;hge.h&gt;
#include &lt;hgedistort.h&gt;
#include &lt;math.h&gt;

HGE *hge = 0;
HTEXTURE tex;
hgeDistortionMesh *dis;
</pre>
<p>
Затем мы объявим несколько констант, которые нам потребуются. Здесь мы зададим разрешение сетки и 
положение на экране:
</p>
<pre>
const int nRows=16;
const int nCols=16;

const float meshx=144;
const float meshy=44;
</pre>
<p>
В <b>FrameFunc</b> (функции кадра) нам тоже понадобятся перменные. Некоторые из них нужны для работы 
со временем и остальные для вычисления перемещений:
</p>
<pre>
  float dt;
  static float t=0.0f;
  int i, j, col;
</pre>
<p>
Ну, вот здесь, самая хитрая часть. Чтобы анимировать нашу сетку, вычислим ее перемещение и цвета, 
основываясь на времени, которое прошло с предыдущего обновления:
</p>
<pre>
  dt=hge->Timer_GetDelta();
  t+=dt;

  for(i=0; i&lt;nRows; i++)
    for(j=1; j&lt;nCols-1; j++)
    {
      dis->SetDisplacement(j, i, cosf(t*5+j/2)*15,0,HGEDISP_NODE);
      col=int((cosf(t*5+(i+j)/2)+1)*35);
      dis->SetColor(j, i, 0xFF<<24 | col<<16 | col<<8 | col);
    }
</pre>
<p>
И наконец, мы рисуем сетку на экране:
</p>
<pre>
  hge->Gfx_BeginScene();
  hge->Gfx_Clear(0);
  dis->Render(meshx, meshy);
  hge->Gfx_EndScene();
</pre>
<p>
В функции <b>WinMain</b> мы должны загрузить текстуру и проинициализировать сетку:
</p>
<pre>
  tex=hge->Texture_Load("texture.jpg");
  dis=new hgeDistortionMesh(nCols, nRows);
  dis->SetTexture(tex);
  dis->SetTextureRect(0, 0, 512, 512);
  dis->SetBlendMode(BLEND_COLORADD|BLEND_ALPHABLEND|BLEND_ZWRITE);
  dis->Clear(0xFF000000);
</pre>
<p>
И в конце приложения, необходимо удалить текстуру и сетку из памяти:
</p>
<pre>
  delete dis;
  hge->Texture_Free(tex);
</pre>
<p>
Вуаля! Насколько все просто.
<br><br>
Полный исходный код с детальными комментариями для этого примера можно найти в директории <b>tutorials\tutorial05</b>. 
Требуемые медиа файлы можно найти в директории <b>tutorials\precompiled</b>.
</p>
<br>
</td></tr></table>
</td>

</tr></table>
</body>

</html>